# Generated by Django 5.2.4 on 2025-08-01 22:47

import django.db.models.deletion
import django.utils.timezone
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('core', '0001_initial'),
        ('ventas', '0001_initial'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='ComprobanteFiscal',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('reintentos_timbrado', models.PositiveIntegerField(default=0)),
                ('fecha_ultimo_intento', models.DateTimeField(blank=True, null=True)),
                ('uuid', models.CharField(blank=True, max_length=36, null=True, unique=True)),
                ('xml', models.FileField(blank=True, null=True, upload_to='cfdi_xmls/')),
                ('pdf', models.FileField(blank=True, null=True, upload_to='cfdi_pdfs/')),
                ('fecha_timbrado', models.DateTimeField(blank=True, null=True)),
                ('estado', models.CharField(choices=[('PENDIENTE', 'Pendiente'), ('TIMBRADO', 'Timbrado'), ('CANCELADO', 'Cancelado'), ('ERROR', 'Error')], default='PENDIENTE', max_length=20)),
                ('error_mensaje', models.TextField(blank=True, null=True)),
                ('tipo', models.CharField(choices=[('FACTURA', 'Factura'), ('NOTA_CREDITO', 'Nota de Crédito'), ('RECIBO_NOMINA', 'Recibo de Nómina')], default='FACTURA', max_length=20)),
                ('serie', models.CharField(blank=True, max_length=10, null=True)),
                ('folio', models.PositiveIntegerField(blank=True, null=True)),
                ('correo_enviado', models.BooleanField(default=False)),
                ('estado_sat', models.CharField(blank=True, max_length=50, null=True)),
                ('fecha_estado_sat', models.DateTimeField(blank=True, null=True)),
                ('acuse_cancelacion_xml', models.FileField(blank=True, null=True, upload_to='cfdi_acuses/')),
                ('metodo_pago', models.CharField(blank=True, choices=[('PUE', 'Pago en una sola exhibición'), ('PPD', 'Pago en parcialidades o diferido')], help_text='Método de pago según catálogo SAT (PUE, PPD)', max_length=3, null=True)),
                ('forma_pago', models.CharField(blank=True, choices=[('01', 'Efectivo'), ('02', 'Cheque nominativo'), ('03', 'Transferencia electrónica de fondos'), ('04', 'Tarjeta de crédito'), ('05', 'Monedero electrónico'), ('06', 'Dinero electrónico'), ('08', 'Vales de despensa'), ('12', 'Dación en pago'), ('13', 'Pago por subrogación'), ('14', 'Pago por consignación'), ('15', 'Condonación'), ('17', 'Compensación'), ('23', 'Novación'), ('24', 'Confusión'), ('25', 'Remisión de deuda'), ('26', 'Prescripción o caducidad'), ('27', 'A satisfacción del acreedor'), ('28', 'Tarjeta de débito'), ('29', 'Tarjeta de servicios'), ('30', 'Aplicación de anticipos'), ('31', 'Intermediario de pagos'), ('99', 'Por definir')], help_text='Forma de pago clave SAT (Ej: 01 Efectivo, 03 Transferencia)', max_length=3, null=True)),
                ('exportacion', models.CharField(choices=[('01', 'No aplica'), ('02', 'Definitiva'), ('03', 'Temporal')], default='01', help_text='Exportación según el catálogo SAT c_Exportacion', max_length=2)),
                ('facturama_id', models.CharField(blank=True, max_length=100, null=True)),
                ('motivo_cancelacion', models.CharField(blank=True, choices=[('01', 'Comprobante emitido con errores con relación'), ('02', 'Comprobante emitido con errores sin relación'), ('03', 'No se llevó a cabo la operación'), ('04', 'Operación nominativa relacionada en la factura global')], max_length=3, null=True)),
                ('sustitucion_uuid', models.CharField(blank=True, max_length=36, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('empresa', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.empresa')),
                ('venta', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, to='ventas.venta')),
            ],
        ),
        migrations.CreateModel(
            name='EnvioCorreoCFDI',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('destinatario', models.EmailField(max_length=254)),
                ('fecha_envio', models.DateTimeField(auto_now_add=True)),
                ('comprobante', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='envios', to='facturacion.comprobantefiscal')),
                ('enviado_por', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='TimbradoLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('fecha_intento', models.DateTimeField(default=django.utils.timezone.now)),
                ('exito', models.BooleanField(default=False)),
                ('mensaje_error', models.TextField(blank=True, null=True)),
                ('uuid_obtenido', models.CharField(blank=True, max_length=36, null=True)),
                ('facturama_id', models.CharField(blank=True, max_length=100, null=True)),
                ('comprobante', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='logs_timbrado', to='facturacion.comprobantefiscal')),
            ],
            options={
                'ordering': ['-fecha_intento'],
            },
        ),
        migrations.AddIndex(
            model_name='comprobantefiscal',
            index=models.Index(fields=['estado'], name='facturacion_estado_4c1711_idx'),
        ),
        migrations.AddIndex(
            model_name='comprobantefiscal',
            index=models.Index(fields=['tipo'], name='facturacion_tipo_904fe7_idx'),
        ),
    ]
